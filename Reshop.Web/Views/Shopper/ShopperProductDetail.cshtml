@model ProductDetailForShow
@{
    ViewData["Title"] = " جزعیات محصول" + Model.ProductName;
}

@section Css
{
    <link href="~/css/calender.min.css" rel="stylesheet" />
    <link href="~/css/select.css" rel="stylesheet" />
}

<ul class="breadcrumb">
    <li>
        <a href="/">ریشاپ</a>
    </li>
    <li>
        <a asp-controller="Shopper" asp-action="ManageProducts">لیست کالا ها</a>
    </li>
    <li>
        <a asp-controller="Shopper" asp-action="ShopperProductDetail"
           asp-route-shopperProductId="@ViewBag.ShopperProductId.ToString()">
            جزئیات کالا @Model.ProductName
        </a>
    </li>
</ul>

<section class="product-detail mb-3">
    <div class="row">
        <!-- img part -->
        <div class="col-sm-12 col-md-4 mb-3 mb-md-0">
            <div class="box-shadow">
                <div class="show-img-box">
                    <img src="/images/ProductImages/@Model.ProductImages.First()" alt="@Model.ProductName">
                </div>

                <!-- start slider pictures -->
                <div id="owl-one" class="owl-carousel owl-theme" style="border-top: 1px solid #eee;">

                    @foreach (var item in Model.ProductImages)
                    {
                        <div class="mini-pic-slider">
                            <a href="#">
                                <img src="/images/ProductImages/@item" alt="@Model.ProductName">
                            </a>
                        </div>
                    }

                </div>
            </div>
        </div>

        <!-- product data part -->
        <div class="col-sm-12 col-md-8">
            <div class="general-data box-shadow">
                <span class="part-title">مشخصات محصول</span>
                <div>
                    <h3><i class="far fa-tags"></i> نام کالا: </h3>
                    <span>
                        @Model.ProductName
                    </span>
                </div>
                <div>
                    <h3><i class="far fa-tags"></i> نام برند: </h3>
                    <span>
                        @Model.BrandName
                    </span>
                </div>
                <div>
                    <h3><i class="far fa-tags"></i> تعداد فروشنده ها: </h3>
                    <span>
                        @Model.ShoppersCount
                    </span>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="chart box-shadow mb-3">
    <span class="part-title">آمار کلی</span>


    <div class="scrollChart">
        <h2 class="chartheader">آمر کلی ماه اخیر</h2>
        <div id="LastMonthDataLineChart" style="overflow: hidden; width: 100%; min-width: 877px;"></div>
    </div>


    <div class="row">
        <div class="col-sm-12 col-md-6">
            <h2 class="chartheader">آمار فروش بین فروشنده ها</h2>
            <div id="BestShoppersPieChart"></div>
        </div>


        <div class="col-sm-12 col-md-6">
            <h2 class="chartheader">بهترین فروشنده های ماه اخیر</h2>
            <div id="LastMonthBestShoppersPieChart"></div>
        </div>
    </div>





</section>

<section class="colors box-shadow mb-3">
    <span class="part-title">رنگ ها</span>

    <div class="scrollChart">
        <h2 class="chartheader">نمودار رنگ ها</h2>
        <div id="ColorsColumnChart" style="overflow: hidden; width: 100%; min-width: 877px;"></div>
    </div>


    <button class="btn btn-success text-white mt-3 mb-3"
            onclick="ShowModal('@Url.Action("AddShopperProductColor", "Shopper", new {productId= Model.ProductId}, Context.Request.Scheme)','افزودن رنگ')">
        افزودن رنگ
    </button>


    @foreach (var color in Model.Colors)
    {
        <div class="item">
            <div class="title">
                <h3>@color.Item2</h3>
            </div>
            <button type="button" class="collapsible" onclick="ColorCollapsibleOfManager(this,'colorDetail@(color.Item1)', '@Url.Action("ShopperProductColorDetail","Shopper",new{productId = Model.ProductId, colorId = color.Item1},Context.Request.Scheme)')"></button>
            <div class="content" id="colorDetail@(color.Item1)">

            </div>
        </div>

    }

</section>

@section AfterMainOptions
{
    <partial name="_Modal" />
}


@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>



    <script>
        google.charts.load('current',
            {
                'packages': ['corechart']
            });
        google.charts.setOnLoadCallback(drawLastMonthDataLineChart);
        google.charts.setOnLoadCallback(drawLastMonthBestShoppersPieChart);
        google.charts.setOnLoadCallback(drawBestShoppersPieChart);
        google.charts.setOnLoadCallback(drawColorsColumnChart);

        function drawLastMonthDataLineChart() {

            $.ajax({
                type: 'GET',
                url: '/api/Shopper/GetLastThirtyDayProductData/' + @Model.ProductId,
            }).done(function(res) {
                var data = new google.visualization.DataTable();

                data.addColumn('string', 'تاریخ');
                data.addColumn('number', 'بازدید');
                data.addColumn('number', 'فروش');


                $.each(res,
                    function(index, value) {
                        data.addRow([value.date, value.viewCount, value.sellCount]);
                    });

                var options = {
                    width: '100%',
                    height: '100%',
                    isStacked: 'relative',
                    fontName: 'Sahel, sans-serif',
                    color: '#4d4d4d',
                    fontSize: 17,
                    height: 400,
                    curveType: 'function',
                    colors: ['#FC5400', '#3366cc', '#f95d6a', '#58508d'],
                    pointSize: 3,
                    chartArea: {
                        right: 0,
                        top: 20,
                        left: 100,
                        width: '95%',
                    },


                    hAxis: {
                        direction: 1,
                        slantedText: true,
                        slantedTextAngle: 50,
                    },

                    vAxis: {
                        format: 'short',
                        title: 'تعداد',
                        titleTextStyle: {
                            color: '#333',
                        },
                        minValue: 0,
                        scaleType: 'Linear',
                    },
                    legend: {
                        position: 'bottom'
                    }
                };

                var chart = new google.visualization.LineChart(document.getElementById('LastMonthDataLineChart'));

                chart.draw(data, options);
            });
        }

        function drawLastMonthBestShoppersPieChart() {
            $.ajax({
                type: 'GET',
                url: '/api/Shopper/GetLastThirtyDayBestShoppersOfProduct/' + @Model.ProductId,
            }).done(function(res) {

                var data = new google.visualization.DataTable();

                data.addColumn('string', 'نام فروشگاه');
                data.addColumn('number', 'تعداد فروش');

                $.each(res,
                    function(index, value) {
                        data.addRow([value.item1, value.item2]);
                    });

                var options = {
                    width: '100%',
                    height: '100%',
                    isStacked: 'relative',
                    fontName: 'Sahel, sans-serif',
                    color: '#4d4d4d',
                    fontSize: 17,
                    height: 400,
                    pieHole: 0.2,
                    pieStartAngle: 100,
                    chartArea: {
                        left: 0,
                        top: 20,
                        width: '100%',
                    },
                    legend: {
                        position: 'bottom',
                        maxLines: 4
                    }
                };

                var chart = new google.visualization.PieChart(document.getElementById('LastMonthBestShoppersPieChart'));

                chart.draw(data, options);
            });
        }

        function drawBestShoppersPieChart() {
            $.ajax({
                type: 'GET',
                url: '/api/Shopper/GetBestShoppersOfProduct/' + @Model.ProductId,
            }).done(function(res) {

                var data = new google.visualization.DataTable();

                data.addColumn('string', 'نام فروشگاه');
                data.addColumn('number', 'تعداد فروش');

                $.each(res,
                    function(index, value) {
                        data.addRow([value.item1, value.item2]);
                    });

                var options = {
                    width: '100%',
                    height: '100%',
                    isStacked: 'relative',
                    fontName: 'Sahel, sans-serif',
                    color: '#4d4d4d',
                    fontSize: 17,
                    height: 400,
                    pieHole: 0.2,
                    pieStartAngle: 100,
                    chartArea: {
                        left: 0,
                        top: 20,
                        width: '100%',
                    },
                    legend: {
                        position: 'bottom',
                        maxLines: 4
                    }
                };

                var chart = new google.visualization.PieChart(document.getElementById('BestShoppersPieChart'));

                chart.draw(data, options);
            });
        }

        function drawColorsColumnChart() {
            $.ajax({
                type: 'GET',
                url: '/api/Shopper/GetColorsOfShopperProductData/' + @Model.ProductId,
            }).done(function(res) {
                var data = new google.visualization.DataTable();

                data.addColumn('string', 'رنگ');
                data.addColumn('number', 'بازدید');
                data.addColumn('number', 'فروش');
                data.addColumn('number', 'مرجوعی');

                $.each(res,
                    function(index, value) {
                        data.addRow([value.item1, value.item2, value.item3, value.item4]);
                    });

                var options = {
                    width: '100%',
                    height: '100%',
                    fontName: 'Sahel, sans-serif',
                    color: '#4d4d4d',
                    fontSize: 17,
                    height: 400,
                    colors: ['#FC5400', '#3366cc', '#f95d6a', '#58508d'],
                    chartArea: {
                        right: 0,
                        top: 20,
                        left: 100,
                        width: '95%',
                    },
                    hAxis: {
                        direction: 1,
                        slantedText: true,
                        slantedTextAngle: 50,
                    },
                    vAxis: {
                        format: 'short',
                        title: 'تعداد',
                        titleTextStyle: {
                            color: '#333',
                        },
                        minValue: 0,
                        scaleType: 'Linear',
                    },
                    legend: {
                        position: 'bottom'
                    }
                };

                var chart = new google.visualization.ColumnChart(document.getElementById('ColorsColumnChart'));

                chart.draw(data, options);
            });
        }


        window.addEventListener('resize', drawLastMonthDataLineChart);
        window.addEventListener('resize', drawLastMonthBestShoppersPieChart);
        window.addEventListener('resize', drawBestShoppersPieChart);
        window.addEventListener('resize', drawColorsColumnChart);
    </script>
}
